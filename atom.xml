<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>blog.calouni.win</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="blog.calouni.win/"/>
  <updated>2017-05-17T06:53:21.000Z</updated>
  <id>blog.calouni.win/</id>
  
  <author>
    <name>fangjiale</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>虚拟键盘的一些问题</title>
    <link href="blog.calouni.win/virtual_keyboard/"/>
    <id>blog.calouni.win/virtual_keyboard/</id>
    <published>2017-04-21T22:49:50.000Z</published>
    <updated>2017-05-17T06:53:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>移动端虚拟键盘的弹出和收起是监听不到事件的，移动端虚拟键盘出现的条件是：文本框（文本类）获得焦点。</p>
<p>1、导航栏和尾部为fixed时，弹出虚拟键盘时，导航栏的位置会出现偏移的情况<br>解决方法： 监听input的focus，聚焦则fixed改为static；定时器的存在是要把static状态改回fixed状态。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  $(<span class="string">'#dl_app img'</span>).hide();</div><div class="line">&#125;, <span class="number">100</span>);</div><div class="line"></div><div class="line"><span class="built_in">window</span>.alert = <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</div><div class="line">  $(<span class="string">'body'</span>).append(<span class="string">'&lt;div&gt;'</span> + msg + <span class="string">'&lt;/div&gt;'</span>)</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">window</span>.res = <span class="literal">null</span>;</div><div class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fixedWatch</span>(<span class="params">el</span>) </span>&#123;</div><div class="line">  alert(i++);</div><div class="line">  <span class="keyword">if</span>(<span class="built_in">document</span>.activeElement.nodeName == <span class="string">'INPUT'</span>)&#123;</div><div class="line">    el.css(<span class="string">'position'</span>, <span class="string">'static'</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    el.css(<span class="string">'position'</span>, <span class="string">'fixed'</span>);</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">window</span>.res ) &#123; clearInterval(<span class="built_in">window</span>.res ); <span class="built_in">window</span>.res  = <span class="literal">null</span>; &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$(<span class="string">'input'</span>).focus(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span>(!<span class="built_in">window</span>.res) &#123;</div><div class="line">    fixedWatch($(<span class="string">'#headerview header'</span>));</div><div class="line">    <span class="built_in">window</span>.res = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      fixedWatch($(<span class="string">'#headerview header'</span>));</div><div class="line">    &#125;, <span class="number">500</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>2、当页面初始化时，要自动聚焦input，弹出虚拟键盘，这做不到。<br>网上提供的模拟用户点击之类都是无效的，先mark，有了好方法之后再补充。弹出的条件是必须要用户实际有操作。</p>
<p>h5页面做不到，但内嵌在app里面input只要写了focus事件就能聚焦调起虚拟键盘。如果是搜索框，虚拟键盘输入时右下角为换行键，如果点换行也是能提交input的搜索的，但是虚拟键盘不能自动缩回去。需要做的是：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).keydown(<span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (event.keyCode == <span class="number">13</span>) &#123;</div><div class="line">        btnSearch.click(); <span class="comment">//触发搜索按钮的点击</span></div><div class="line">        iptSearch.blur(); <span class="comment">//input 失焦</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//可以阻止浏览器默认事件等</span></div><div class="line">      &#125;</div><div class="line">  &#125;);</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;移动端虚拟键盘的弹出和收起是监听不到事件的，移动端虚拟键盘出现的条件是：文本框（文本类）获得焦点。&lt;/p&gt;
&lt;p&gt;1、导航栏和尾部为fixed时，弹出虚拟键盘时，导航栏的位置会出现偏移的情况&lt;br&gt;解决方法： 监听input的focus，聚焦则fixed改为static；定时器的存在是要把static状态改回fixed状态。&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;setTimeout(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  $(&lt;span class=&quot;string&quot;&gt;&#39;#dl_app img&#39;&lt;/span&gt;).hide();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.alert = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;msg&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  $(&lt;span class=&quot;string&quot;&gt;&#39;body&#39;&lt;/span&gt;).append(&lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;div&amp;gt;&#39;&lt;/span&gt; + msg + &lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;/div&amp;gt;&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.res = &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;fixedWatch&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;el&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  alert(i++);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.activeElement.nodeName == &lt;span class=&quot;string&quot;&gt;&#39;INPUT&#39;&lt;/span&gt;)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    el.css(&lt;span class=&quot;string&quot;&gt;&#39;position&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;static&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    el.css(&lt;span class=&quot;string&quot;&gt;&#39;position&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;fixed&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.res ) &amp;#123; clearInterval(&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.res ); &lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.res  = &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;; &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$(&lt;span class=&quot;string&quot;&gt;&#39;input&#39;&lt;/span&gt;).focus(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.res) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    fixedWatch($(&lt;span class=&quot;string&quot;&gt;&#39;#headerview header&#39;&lt;/span&gt;));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.res = setInterval(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      fixedWatch($(&lt;span class=&quot;string&quot;&gt;&#39;#headerview header&#39;&lt;/span&gt;));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;, &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="虚拟键盘" scheme="blog.calouni.win/tags/%E8%99%9A%E6%8B%9F%E9%94%AE%E7%9B%98/"/>
    
  </entry>
  
  <entry>
    <title>多图滑动兼容浏览器默认行为</title>
    <link href="blog.calouni.win/carousel/"/>
    <id>blog.calouni.win/carousel/</id>
    <published>2017-04-19T22:49:50.000Z</published>
    <updated>2017-05-17T09:53:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>页面元素结构如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"banner"</span>&gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"banner-inner"</span>&gt;</span></span></div><div class="line">		<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"banner-item"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"switch banner-switch"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"switch-item cur"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"switch-item"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>一般浏览器表现良好，但是碰到qq，uc等含有左滑右滑都会前进后退行为的浏览器就会不太友好。 这明显是浏览器默认的行为，可以通过e.preventDefault(); 来禁止，经过调试，只需在touchmove的时候禁止就可以了。 刚开始禁止的是banner-inner这个div的touchmove，因为有关滑动的操作都是绑在这个元素上面。这样之后滑动touchmove的时候表现良好，但松手后，banner-inner进行transration时就还是会触发浏览器默认行为。 就在想无论是否在动画过程中，触发的不都是banner-inner这个元素的touchmove事件，而且已经禁止默认事件了，为什么还会有浏览器默认行为呢。 经过多次尝试与监听，发现动画过程中，用户触发的是banner-inner的父级，也就是banner元素的事件。 所以解决办法是添加了banner的touchmove事件监听，就是下面代码中加粗的那部分，禁止默认事件即可。<br>下面多图组件的代码</p>
<a id="more"></a>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> $<span class="built_in">window</span> = $(<span class="built_in">window</span>);</div><div class="line">  <span class="keyword">var</span> defaultOpts = &#123;</div><div class="line">      <span class="attr">wrap</span>: <span class="string">'.banner-inner'</span>,</div><div class="line">      <span class="attr">item</span>: <span class="string">'.banner-item'</span>,</div><div class="line">      <span class="attr">indicator</span>: <span class="string">'.banner-switch'</span>,</div><div class="line">      <span class="attr">cur</span>: <span class="number">0</span>,</div><div class="line">      <span class="attr">duration</span>: <span class="number">0.5</span>,      <span class="comment">// 动画持续时间 单位s</span></div><div class="line">      delay: <span class="number">500</span>         <span class="comment">// 动画执行间隔 单位s</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> Carousel = <span class="function"><span class="keyword">function</span> (<span class="params">obj, opts</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.timer = <span class="literal">null</span>;</div><div class="line">    <span class="keyword">this</span>.init(obj, opts);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  Carousel.prototype = &#123;</div><div class="line">    <span class="attr">play</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> _this = <span class="keyword">this</span>;</div><div class="line">      _this.timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        _this.turnItem(<span class="number">1</span>);</div><div class="line">      &#125;, _this.opts.delay * <span class="number">1000</span>);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">turnItem</span>: <span class="function"><span class="keyword">function</span>(<span class="params">step</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> _this = <span class="keyword">this</span>;</div><div class="line">      <span class="keyword">var</span> opts = _this.opts;</div><div class="line">      <span class="keyword">if</span>(!opts.isLock) &#123;</div><div class="line">        opts.pos += step;<span class="comment">//-1  step 0 pos -2</span></div><div class="line">        opts.cur = _this.resetVal(opts.cur + step);<span class="comment">//2</span></div><div class="line">        <span class="keyword">var</span> next = _this.resetVal(opts.cur + step);<span class="comment">//1 2</span></div><div class="line"></div><div class="line">        clearInterval(_this.timer);</div><div class="line">        _this.$item.eq(opts.cur).css(&#123;<span class="attr">left</span>: opts.pos * opts.itemW + <span class="string">'px'</span>&#125;);</div><div class="line">        _this.$item.eq(next).css(&#123;<span class="attr">left</span>: (opts.pos + step) * opts.itemW + <span class="string">'px'</span>&#125;);</div><div class="line">        _this.$wrap.css(&#123;<span class="attr">transition</span>: <span class="string">'transform '</span> + opts.duration + <span class="string">'s'</span>, <span class="attr">transform</span>: <span class="string">'translate3d('</span> + opts.pos * opts.itemW * <span class="number">-1</span> + <span class="string">'px,0,0)'</span>&#125;);</div><div class="line">        <span class="comment">//_this.$indicator.css(&#123;transition: 'transform ' + opts.duration / 2 + 's', transform: 'translate3d(' + opts.pos % opts.indicatorCount * 100 + '%,0,0)'&#125;);</span></div><div class="line">        <span class="keyword">if</span>(opts.indicatorCount&lt;<span class="number">3</span>)&#123;</div><div class="line">          step &amp;&amp; _this.$indicator.find(<span class="string">'.cur'</span>).removeClass(<span class="string">'cur'</span>).siblings().addClass(<span class="string">'cur'</span>);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">          _this.$indicator.find(<span class="string">'.switch-item'</span>).removeClass(<span class="string">'cur'</span>);</div><div class="line">          _this.$indicator.find(<span class="string">'.switch-item'</span>).eq(opts.cur).addClass(<span class="string">'cur'</span>);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">resetVal</span>: <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> itemCount = <span class="keyword">this</span>.opts.itemCount;</div><div class="line">      <span class="keyword">if</span>(val &gt; itemCount - <span class="number">1</span>) &#123;</div><div class="line">        val = <span class="number">0</span>;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(val &lt; <span class="number">0</span>) &#123;</div><div class="line">        val = itemCount - <span class="number">1</span>;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> val;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">touchEvent</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> _this = <span class="keyword">this</span>;</div><div class="line">      <span class="comment">// $window.on('resize', _this.refresh(_this));</span></div><div class="line">      $<span class="built_in">window</span>.on(<span class="string">'resize'</span>, _this.refresh(_this));</div><div class="line"></div><div class="line">      <span class="keyword">var</span> sx = sy = ex = ey = <span class="number">0</span>;</div><div class="line"></div><div class="line">      _this.$wrap.on(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> touch = e.originalEvent.changedTouches[<span class="number">0</span>];</div><div class="line">                    sx = touch.pageX;</div><div class="line">                    sy = touch.pageY;</div><div class="line">                    clearInterval(_this.timer);</div><div class="line">                &#125;).on(<span class="string">'touchmove'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> touch = e.originalEvent.changedTouches[<span class="number">0</span>];</div><div class="line">                    <span class="keyword">var</span> x = touch.pageX;</div><div class="line">                    <span class="keyword">var</span> y = touch.pageY;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(x-sx) &gt; <span class="built_in">Math</span>.abs(y-sy) * <span class="number">2</span>) &#123;</div><div class="line">                      _this.$wrap.css(&#123;<span class="attr">transition</span>: <span class="string">'transform 0s'</span>, <span class="attr">transform</span>: <span class="string">'translate3d('</span> + (_this.opts.pos * _this.opts.itemW * <span class="number">-1</span> + (x - sx)) + <span class="string">'px,0,0)'</span>&#125;);</div><div class="line">                      e.preventDefault();</div><div class="line">                    &#125;</div><div class="line">                &#125;).on(<span class="string">'touchend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> touch = e.originalEvent.changedTouches[<span class="number">0</span>];</div><div class="line">                    ex = touch.pageX;</div><div class="line">                    ey = touch.pageY;</div><div class="line">                    <span class="keyword">var</span> x = ex - sx ;</div><div class="line">                    <span class="keyword">var</span> _x = <span class="built_in">Math</span>.abs(x);</div><div class="line">                    <span class="keyword">var</span> step = <span class="number">0</span>;</div><div class="line">                    <span class="keyword">if</span>(_x &gt; <span class="built_in">Math</span>.abs(ey - sy) &amp;&amp; _x &gt; <span class="number">80</span>) &#123;</div><div class="line">                      step = x &gt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">                    &#125;</div><div class="line">                    _this.turnItem(step);</div><div class="line">                    _this.play();</div><div class="line">                &#125;);</div><div class="line"></div><div class="line">      _this.$box.on(<span class="string">'touchmove'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> touch = e.originalEvent.changedTouches[<span class="number">0</span>];</div><div class="line">        <span class="keyword">var</span> x = touch.pageX;</div><div class="line">        <span class="keyword">var</span> y = touch.pageY;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(x-sx) &gt; <span class="built_in">Math</span>.abs(y-sy) * <span class="number">2</span>) &#123;</div><div class="line">          e.preventDefault();       </div><div class="line">        &#125;</div><div class="line">      &#125;)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">initView</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj, options</span>) </span>&#123;</div><div class="line">      <span class="comment">//test</span></div><div class="line">      <span class="keyword">var</span> _this = <span class="keyword">this</span>;</div><div class="line">      <span class="keyword">var</span> opts = $.extend(&#123;&#125;, defaultOpts, options);</div><div class="line"></div><div class="line">      opts.itemCount = <span class="number">0</span>;         <span class="comment">//  轮播item个数</span></div><div class="line">      opts.itemW = <span class="number">0</span>;             <span class="comment">//  轮播item宽度</span></div><div class="line">      opts.indicatorCount = <span class="number">0</span>;    <span class="comment">//  控制器item个数</span></div><div class="line">      opts.cur = <span class="number">0</span>;               <span class="comment">//  当前item显示位置</span></div><div class="line">      opts.pos = <span class="number">0</span>;               <span class="comment">//  当前容器显示位置</span></div><div class="line">      opts.isLock = <span class="literal">false</span>;        <span class="comment">//  lock</span></div><div class="line"></div><div class="line">      <span class="keyword">this</span>.$box = $(obj);</div><div class="line">      <span class="keyword">this</span>.$wrap = <span class="keyword">this</span>.$box.find(opts.wrap);</div><div class="line">      <span class="keyword">this</span>.$item = <span class="keyword">this</span>.$wrap.find(opts.item);</div><div class="line">      <span class="keyword">this</span>.$indicator = <span class="keyword">this</span>.$box.find(opts.indicator);</div><div class="line"></div><div class="line">      opts.itemCount = opts.indicatorCount = <span class="keyword">this</span>.$item.length;</div><div class="line">      opts.itemW = <span class="keyword">this</span>.$box.width();</div><div class="line"></div><div class="line">      <span class="keyword">if</span>(opts.itemCount &lt; <span class="number">2</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(opts.itemCount &lt; <span class="number">3</span>)&#123;</div><div class="line">        <span class="keyword">this</span>.$item.clone().appendTo(<span class="keyword">this</span>.$wrap);</div><div class="line">        <span class="keyword">this</span>.$item = <span class="keyword">this</span>.$wrap.find(opts.item);</div><div class="line">        opts.itemCount = <span class="keyword">this</span>.$item.length;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// 初始化item位置</span></div><div class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; opts.itemCount - <span class="number">1</span> ; i++) &#123;</div><div class="line">        <span class="keyword">this</span>.$item.eq(i).css(&#123;<span class="attr">left</span>: i * opts.itemW + <span class="string">'px'</span>&#125;);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">this</span>.$item.eq(i).css(&#123;<span class="attr">left</span>: <span class="number">-1</span> * opts.itemW + <span class="string">'px'</span>&#125;);</div><div class="line"></div><div class="line">      <span class="comment">// 初始化容器</span></div><div class="line">      <span class="keyword">this</span>.$wrap.css(&#123;<span class="attr">transition</span>: <span class="string">'transform '</span> + opts.duration + <span class="string">'s'</span>, <span class="attr">transform</span>: <span class="string">'translate3d(0,0,0)'</span>&#125;);</div><div class="line"></div><div class="line">      <span class="comment">// 初始化控制器</span></div><div class="line">      <span class="keyword">this</span>.$indicator.width(<span class="number">100</span> / opts.indicatorCount + <span class="string">'%'</span>);</div><div class="line"></div><div class="line">      <span class="keyword">this</span>.opts = opts;</div><div class="line"></div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj, opts</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span>(!<span class="keyword">this</span>.initView(obj, opts)) &#123;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">this</span>.touchEvent();</div><div class="line">      <span class="keyword">this</span>.play();</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">refresh</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">this</span>.opts.itemW = <span class="keyword">this</span>.$box.width();</div><div class="line">      <span class="keyword">this</span>.opts.isLock = <span class="literal">false</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">_throttle</span>: <span class="function"><span class="keyword">function</span>(<span class="params">fn, delay, duration, cxt</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> timer = <span class="literal">null</span>;</div><div class="line">      <span class="keyword">var</span> t_start;</div><div class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> args = <span class="built_in">arguments</span>;</div><div class="line">        <span class="keyword">var</span> t_curr = +<span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"></div><div class="line">        clearTimeout(timer);</div><div class="line">        cxt.opts.isLock = <span class="literal">true</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!t_start) &#123;</div><div class="line">          t_start = t_curr;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (t_curr - t_start &gt;= duration) &#123;</div><div class="line">          fn.apply(cxt, args);</div><div class="line">          t_start = t_curr;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            fn.apply(cxt, args);</div><div class="line">          &#125;, delay);</div><div class="line">        &#125;</div><div class="line">      &#125;;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">  $.fn.Carousel = <span class="function"><span class="keyword">function</span>(<span class="params">opts</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</div><div class="line">      !$(<span class="keyword">this</span>).data(<span class="string">'carousel'</span>) &amp;&amp; $(<span class="keyword">this</span>).data(<span class="string">'carousel'</span>, <span class="keyword">new</span> Carousel(<span class="keyword">this</span>, opts));</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;)(jQuery);</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;页面元素结构如下：&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;div &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;banner&quot;&lt;/span&gt;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;banner-inner&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;banner-item&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;switch banner-switch&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;switch-item cur&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;switch-item&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;一般浏览器表现良好，但是碰到qq，uc等含有左滑右滑都会前进后退行为的浏览器就会不太友好。 这明显是浏览器默认的行为，可以通过e.preventDefault(); 来禁止，经过调试，只需在touchmove的时候禁止就可以了。 刚开始禁止的是banner-inner这个div的touchmove，因为有关滑动的操作都是绑在这个元素上面。这样之后滑动touchmove的时候表现良好，但松手后，banner-inner进行transration时就还是会触发浏览器默认行为。 就在想无论是否在动画过程中，触发的不都是banner-inner这个元素的touchmove事件，而且已经禁止默认事件了，为什么还会有浏览器默认行为呢。 经过多次尝试与监听，发现动画过程中，用户触发的是banner-inner的父级，也就是banner元素的事件。 所以解决办法是添加了banner的touchmove事件监听，就是下面代码中加粗的那部分，禁止默认事件即可。&lt;br&gt;下面多图组件的代码&lt;/p&gt;
    
    </summary>
    
    
      <category term="浏览器" scheme="blog.calouni.win/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
      <category term="兼容" scheme="blog.calouni.win/tags/%E5%85%BC%E5%AE%B9/"/>
    
  </entry>
  
  <entry>
    <title>TCP/IP  HTTP 协议   详解</title>
    <link href="blog.calouni.win/http/"/>
    <id>blog.calouni.win/http/</id>
    <published>2017-04-09T22:49:50.000Z</published>
    <updated>2017-05-17T04:37:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="tcp-ip"><a href="#tcp-ip" class="headerlink" title="tcp/ip"></a>tcp/ip</h2><p>三次握手协议已经听的很烂了，但总觉得模模糊糊，是是而非。</p>
<p>握手三部曲：</p>
<ol>
<li>客户端(syn=j)   ——&gt;服务端     </li>
<li>服务端（syn=k,ack=j+1）——&gt; 客户端</li>
<li>客户端（ack=k+1）——&gt; 服务端<br>如果这三步都成功则tcp连接成功，就可以发数据包了。</li>
</ol>
<p>正因为tcp协议必须经过这样的三部曲，就会有漏洞，比如客户端伪造发送方的ip和端口，给目标服务器发送syn，因为ip和端口都是不存在的，所以服务器发送出去之后，就再也接收不到客户端的回应了。这样服务器会在那里等待以至于超时；一两个超时不会造成问题，但如果是 syn flood 的话，服务器就会有一堆半连接的tcp，就会造成堵塞。</p>
<p>网上有很多syn攻击的工具，hping<br>mac弄起来不是特别方便，先放着，有时间再下工具来测了。</p>
<a id="more"></a>
<h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>HTTP协议是建立在TCP协议之上的一种应用，网站的请求数据都是用的http协议，作为前端程序员用的最多也是http协议。http是应用层的协议，tcp是传输层，它俩不是平行的关系，而是http基于tcp连接。 Tcp只负责连接，没有数据的部分，而http则在tcp连接建立好之后，进行带数据的请求。</p>
<p>现在广泛用的http1.1版本,1.1相对于1.0 升级的地方。</p>
<ol>
<li>1.0的连接是一次连接对应一次请求，服务端返回数据之后就会关闭连接；1.1一次连接对应多次请求，而且多次请求之间不会阻塞等待，可以并行发送请求和接收数据。  （为了解决一个网页文件中有很多的图片内容请求和操作请求，建立和关闭连接都需要代价）</li>
<li>请求头里面加了两个很有用的字段<br><code>Host: open.test.ximalaya.com
Proxy-Connection: keep-alive</code><br>Host 的存在可以写主机名，在服务器ip和端口相同的情况下，一个tcp连接就可以适用于一台服务器上面的不同域名站点的请求。 Proxy-Connection字段可以告诉服务器这次请求完之后，需要怎么处理tcp连接，如果是keep-alive，则不关闭连接。</li>
</ol>
<h3 id="http-1"><a href="#http-1" class="headerlink" title="http"></a>http</h3><h4 id="请求过程"><a href="#请求过程" class="headerlink" title="请求过程"></a>请求过程</h4><p>Http是“请求——回应”，这样的过程，一个请求对应一个响应，发请求之前会建立tcp连接，然后A客户端（浏览器）发请求给（服务器），B拿到内容（一个网页html文件，或者js文件，或者数据），发回给A。如果是html文件，浏览器会去解析显示；如果是js也会自动去运行；如果是数据，可以通过js代码控制，将数据显示给用户。</p>
<h4 id="http-几个部分"><a href="#http-几个部分" class="headerlink" title="http 几个部分"></a>http 几个部分</h4><ol>
<li>request  header 这是一个请求发出去的情况<br><code>GET /opage/category/manage HTTP/1.1
Host: open.test.ximalaya.com
Connection: keep-alive
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Referer: http://open.test.ximalaya.com/opage/index
Accept-Encoding: gzip, deflate, sdch
Accept-Language: zh-CN,zh;q=0.8,en;q=0.6
Cookie: device_id=1778036c-7133-c640-dd92-a618212f76fc;</code><br>这是我复制过来的请求头，request source ，一行一行看就知道所有请求的信息都在这里显示了。 实际项目中有次报错400 （bad request），这种情况最好的解决办法就是打开请求头看个究竟，原来发了一个post给服务器，但相应的url的接口只能接收get方法的请求，如果post方法发过去的请求是不被允许的，就报400错误了。 </li>
<li>response  header 服务器返回的情况<br><code>HTTP/1.1 200 OK
access-control-allow-origin: *
server: node-static/0.7.6
cache-control: max-age=3600
etag: &quot;1687406-180-1492078895000&quot;
date: Fri, 14 Apr 2017 08:04:33 GMT
last-modified: Thu, 13 Apr 2017 10:21:35 GMT
content-type: text/css
content-length: 180
connection: keep-alive</code><br>有关服务器的很多信息会放在这里，http协议版本，状态码，跨域，缓存（Http报头里面还有Last-Modified和ETags字段来定缓存机制，当然还有cache-control字段同时使用和控制。之后有空会写一篇专门的http的缓存机制。 <a href="http://blog.csdn.net/kikikind/article/details/6266101" target="_blank" rel="external">etag与http缓存</a> ）</li>
<li>Response 就是服务器返回的内容  返回的内容就交给浏览器去解析和处理了。</li>
<li>Timing<br>[image:6940E5B8-1711-4E9C-91C6-5BFFB278A0DA-674-000003B35B53FF72/下载.png]<br>Queueing 文件排序需要的时间<br>Stalled  是浏览器得到要发出这个请求的指令到请求可以发出的等待时间，一般是代理协商、以及等待可复用的TCP连接释放的时间，不包括DNS查询、建立TCP连接等时间等<br>Proxy Negotiation  处理代理的时间。  （这个字段其实也是有的，只是图上没表现出来）<br>DNS Lookup  页面上每一个新域都需要解析。 有两种情况，这个时间为空（1、有dns缓存 2、hosts文件里面有写域名和地址的对应关系）<br>Initial connection  建立TCP连接的时间，就相当于客户端从发请求开始到TCP握手结束这一段。<br>SSl （https 数据加密协议）这个字段有一些就没有，ssl这块比tcp协议复杂一些，因为涉及到传输数据的安全性  参考 <a href="http://www.wosign.com/faq/faq2016-0309-04.htm" target="_blank" rel="external">TLS/SSL 握手过程</a></li>
</ol>
<p>Request sent  请求发送所需要的时间，即请求内容从第一个字节开始计算到最后一个字节传完。 即请求数据的上传时间，这部分通常会很短。<br>Waiting  这部分就是请求发送出去后，到接收从服务器返回的第一个字节数据。<br>Content Download 客户端下载服务器返回的数据所用的时间（即从第一字节到下载完成）</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;tcp-ip&quot;&gt;&lt;a href=&quot;#tcp-ip&quot; class=&quot;headerlink&quot; title=&quot;tcp/ip&quot;&gt;&lt;/a&gt;tcp/ip&lt;/h2&gt;&lt;p&gt;三次握手协议已经听的很烂了，但总觉得模模糊糊，是是而非。&lt;/p&gt;
&lt;p&gt;握手三部曲：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;客户端(syn=j)   ——&amp;gt;服务端     &lt;/li&gt;
&lt;li&gt;服务端（syn=k,ack=j+1）——&amp;gt; 客户端&lt;/li&gt;
&lt;li&gt;客户端（ack=k+1）——&amp;gt; 服务端&lt;br&gt;如果这三步都成功则tcp连接成功，就可以发数据包了。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;正因为tcp协议必须经过这样的三部曲，就会有漏洞，比如客户端伪造发送方的ip和端口，给目标服务器发送syn，因为ip和端口都是不存在的，所以服务器发送出去之后，就再也接收不到客户端的回应了。这样服务器会在那里等待以至于超时；一两个超时不会造成问题，但如果是 syn flood 的话，服务器就会有一堆半连接的tcp，就会造成堵塞。&lt;/p&gt;
&lt;p&gt;网上有很多syn攻击的工具，hping&lt;br&gt;mac弄起来不是特别方便，先放着，有时间再下工具来测了。&lt;/p&gt;
    
    </summary>
    
    
      <category term="TCP/IP" scheme="blog.calouni.win/tags/TCP-IP/"/>
    
      <category term="HTTP" scheme="blog.calouni.win/tags/HTTP/"/>
    
  </entry>
  
</feed>
